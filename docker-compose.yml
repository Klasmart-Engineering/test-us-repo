version: '3.9'
services:
    kidsloop-user-service:
        build:
            context: .
            dockerfile: Dockerfile
        container_name: user-service
        environment:
            - DATABASE_URL=postgres://postgres:kidsloop@postgres1
            - STORAGE_BUCKET=my-bucket
            - STORAGE_PROVIDER=vngcloud
            - STORAGE_ENDPOINT=http://localstack1:4566
            - STORAGE_PROJECT_ID=123
            - STORAGE_ACCESS_KEY_ID=test
            - STORAGE_SECRET_ACCESS_KEY=test
            - STORAGE_REGION=HCM01
        expose:
            - '8080'
        ports:
            - '8080:8080'
        depends_on:
            - postgres1
            - localstack1
        command: npm run start
    postgres1:
        container_name: postgres1
        image: postgres
        restart: always
        environment:
            - POSTGRES_PASSWORD=kidsloop
        ports:
            - 5432:5432
    localstack1:
        container_name: localstack1
        image: localstack/localstack:0.12.12
        restart: always
        environment:
            - SERVICES=s3
        ports:
            - 4566:4566
        volumes:
            - ./aws:/docker-entrypoint-initaws.d
