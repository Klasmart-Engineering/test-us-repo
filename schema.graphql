directive @deprecated(
    reason: String = "No longer supported"
) on FIELD_DEFINITION
directive @isAdmin(entity: String) on FIELD_DEFINITION
directive @isAuthenticated on FIELD_DEFINITION
directive @isMIMEType(mimetype: String) on FIELD_DEFINITION

type File {
    filename: String!
    mimetype: String!
    encoding: String!
}

type UserConnection {
    total: Int
    edges: [User!]!
    pageInfo: PageInfo!
}

type OrganizationConnection {
    total: Int
    edges: [Organization]!
    pageInfo: PageInfo!
}

type RoleConnection {
    total: Int
    edges: [Role]!
    pageInfo: PageInfo!
}

type ClassConnection {
    total: Int
    edges: [Class]!
    pageInfo: PageInfo!
}

type PermissionConnection {
    total: Int
    edges: [Permission]!
    pageInfo: PageInfo!
}

type PageInfo {
    hasNextPage: Boolean!
    endCursor: String!
    startCursor: String!
    hasPreviousPage: Boolean!
}

type Query {
    me: User
    user(user_id: ID!): User
    users: [User]
    users_v1(
        after: String
        before: String
        first: Int
        last: Int
    ): UserConnection! @isAdmin(entity: "user")

    my_users: [User!]
    before: String

    organization(organization_id: ID!): Organization
    organizations(organization_ids: [ID!]): [Organization]
        @isAdmin(entity: "organization")
    organizations_v1(
        organization_ids: [ID!]
        after: String
        before: String
        first: Int
        last: Int
    ): OrganizationConnection! @isAdmin(entity: "organization")

    role(role_id: ID!): Role
    roles: [Role]

    roles_v1(
        after: String
        before: String
        first: Int
        last: Int
    ): RoleConnection! @isAdmin(entity: "role")

    permissions(
        after: String
        before: String
        first: Int
        last: Int
    ): PermissionConnection! @isAuthenticated
    classes: [Class]
    classes_v1(
        after: String
        before: String
        first: Int
        last: Int
    ): ClassConnection! @isAdmin(entity: "class")

    class(class_id: ID!): Class

    school(school_id: ID!): School

    age_range(id: ID!): AgeRange @isAdmin(entity: "ageRange")

    grade(id: ID!): Grade @isAdmin(entity: "grade")

    category(id: ID!): Category @isAdmin(entity: "category")
    subcategory(id: ID!): Subcategory @isAdmin(entity: "subcategory")

    subject(id: ID!): Subject @isAdmin(entity: "subject")
    program(id: ID!): Program @isAdmin(entity: "program")
}

scalar Upload
type Mutation {
    me: User
    user(
        user_id: ID!
        given_name: String
        family_name: String
        email: String
        phone: String
        avatar: String
        date_of_birth: String
        username: String
        alternate_email: String
        alternate_phone: String
        gender: String
    ): User
    newUser(
        given_name: String
        family_name: String
        email: String
        phone: String
        avatar: String
        date_of_birth: String
        username: String
        gender: String
    ): User @deprecated(reason: "Use the inviteUser() method")
    switch_user(user_id: ID!): User

    organization(
        organization_id: ID!
        organization_name: String
        address1: String
        address2: String
        phone: String
        shortCode: String
    ): Organization

    role(role_id: ID!): Role
    roles: [Role]

    classes: [Class]
    class(class_id: ID!): Class

    school(school_id: ID!): School

    age_range(id: ID!): AgeRange @isAdmin(entity: "ageRange")

    grade(id: ID!): Grade @isAdmin(entity: "grade")

    category(id: ID!): Category @isAdmin(entity: "category")
    subcategory(id: ID!): Subcategory @isAdmin(entity: "subcategory")

    subject(id: ID!): Subject @isAdmin(entity: "subject")
    program(id: ID!): Program @isAdmin(entity: "program")

    createOrUpateSystemEntities(_: Int): Boolean @isAdmin

    uploadOrganizationsFromCSV(file: Upload!): File @isMIMEType(mimetype: "text/csv")
    uploadUsersFromCSV(file: Upload!): File @isMIMEType(mimetype: "text/csv")
    uploadClassesFromCSV(file: Upload!): File @isMIMEType(mimetype: "text/csv")
    uploadGradesFromCSV(file: Upload!): File @isMIMEType(mimetype: "text/csv")
}

type User {
    user_id: ID!

    #properties
    user_name: String @deprecated(reason: "Use `full_name`.")
    full_name: String
    given_name: String
    family_name: String
    email: String
    phone: String
    date_of_birth: String
    avatar: String
    username: String
    primary: Boolean
    alternate_email: String
    alternate_phone: String
    gender: String
    #connections
    """
    'my_organization' is the Organization that this user has created
    """
    my_organization: Organization
        @deprecated(reason: "Use `organization_ownerships`.")
    organization_ownerships: [OrganizationOwnership]
    memberships: [OrganizationMembership]
    membership(organization_id: ID!): OrganizationMembership

    school_memberships: [SchoolMembership]
    school_membership(school_id: ID!): SchoolMembership

    classesTeaching: [Class]
    classesStudying: [Class]

    #query
    organizationsWithPermission(
        permission_name: String!
    ): [OrganizationMembership]
    schoolsWithPermission(permission_name: String!): [SchoolMembership]
    subjectsTeaching: [Subject] @isAdmin(entity: "subject")

    #mutations
    set(
        given_name: String
        family_name: String
        email: String
        phone: String
        username: String
        date_of_birth: String
        gender: String
        avatar: String
        alternate_email: String
        alternate_phone: String
    ): User
    createOrganization(
        organization_name: String
        email: String # Not being used in resolver.
        address1: String
        address2: String
        phone: String
        shortCode: String
    ): Organization
    merge(other_id: String): User
    addOrganization(organization_id: ID!): OrganizationMembership
    addSchool(school_id: ID!): OrganizationMembership
    setPrimary(_: Int): Boolean @isAdmin(entity: "user")
}

type Organization {
    organization_id: ID!

    #properties
    organization_name: String
    address1: String
    address2: String
    phone: String
    shortCode: String
    status: Status

    #connections

    """
    'owner' is the User that created this Organization
    """
    owner: User @deprecated(reason: "Use `organization_ownerships`.")
    primary_contact: User
    roles: [Role]
    memberships: [OrganizationMembership]
    teachers: [OrganizationMembership]
    students: [OrganizationMembership]
    schools: [School]
    classes: [Class]
    ageRanges: [AgeRange!]
    grades: [Grade!]
    categories: [Category!]
    subcategories: [Subcategory!]
    subjects: [Subject!]
    programs: [Program!]

    #query
    membersWithPermission(
        permission_name: String!
        search_query: String
    ): [OrganizationMembership]
    findMembers(search_query: String!): [OrganizationMembership]

    #mutations
    set(
        organization_name: String
        address1: String
        address2: String
        phone: String
        shortCode: String
    ): Organization
    setPrimaryContact(user_id: ID!): User
    addUser(user_id: ID!, shortcode: String): OrganizationMembership
    inviteUser(
        email: String
        phone: String
        given_name: String
        family_name: String
        date_of_birth: String
        username: String
        gender: String
        shortcode: String
        organization_role_ids: [ID!]
        school_ids: [ID!]
        school_role_ids: [ID!]
        alternate_email: String
        alternate_phone: String
    ): MembershipUpdate
    editMembership(
        email: String
        phone: String
        given_name: String
        family_name: String
        date_of_birth: String
        username: String
        gender: String
        shortcode: String
        organization_role_ids: [ID!]
        school_ids: [ID!]
        school_role_ids: [ID!]
        alternate_email: String
        alternate_phone: String
    ): MembershipUpdate
    createRole(role_name: String!, role_description: String!): Role
    createSchool(school_name: String, shortcode: String): School
    createClass(class_name: String, shortcode: String): Class
    createOrUpdateAgeRanges(age_ranges: [AgeRangeDetail]!): [AgeRange]
    createOrUpdateGrades(grades: [GradeDetail]!): [Grade]
    createOrUpdateCategories(categories: [CategoryDetail]!): [Category]
    createOrUpdateSubcategories(
        subcategories: [SubcategoryDetail]!
    ): [Subcategory]
    createOrUpdateSubjects(subjects: [SubjectDetail]!): [Subject]
    createOrUpdatePrograms(programs: [ProgramDetail]!): [Program]
    delete(_: Int): Boolean
}

type MembershipUpdate {
    user: User
    membership: OrganizationMembership
    schoolMemberships: [SchoolMembership]
}

scalar Date
type OrganizationMembership {
    #properties
    user_id: ID!
    organization_id: ID!
    shortcode: String
    join_timestamp: Date
    status: Status

    #connections
    organization: Organization
    user: User
    roles: [Role]
    classes: [Class]
    schoolMemberships(permission_name: String): [SchoolMembership]

    #query
    checkAllowed(permission_name: ID!): Boolean
    classesTeaching: [Class]

    #mutations
    addRole(role_id: ID!): Role
    addRoles(role_ids: [ID!]!): [Role]
    removeRole(role_id: ID!): OrganizationMembership
    leave(_: Int): Boolean
}

type OrganizationOwnership {
    #properties
    user_id: ID!
    organization_id: ID!
    status: Status

    #connections
    organization: Organization
    user: User
}

type Role {
    role_id: ID!

    #properties
    role_name: String
    role_description: String!
    status: Status!
    system_role: Boolean!

    #connections
    organization: Organization
    memberships: [OrganizationMembership]
    permissions: [Permission]
    permission(permission_name: String!): Permission

    #mutations
    set(role_name: String, role_description: String, system_role: Boolean): Role
    grant(permission_name: String!): Permission
    revoke(permission_name: String!): Boolean
    edit_permissions(permission_names: [String!]): [Permission]
    deny(permission_name: String!): Permission @isAdmin

    delete_role(_: Int): Boolean
}

type Permission {
    permission_id: ID
    permission_name: ID!
    permission_category: String
    permission_group: String
    permission_level: String
    permission_description: String
    allow: Boolean
}

type School {
    school_id: ID!

    #properties
    school_name: String
    shortcode: String
    status: Status

    #connections
    organization: Organization
    memberships: [SchoolMembership]
    membership(user_id: ID!): SchoolMembership
    classes: [Class]
    programs: [Program!]

    #mutations
    set(school_name: String, shortcode: String): School
    addUser(user_id: ID!): SchoolMembership
    editPrograms(program_ids: [ID!]): [Program]
    delete(_: Int): Boolean
}

type SchoolMembership {
    #properties
    user_id: ID!
    school_id: ID!
    join_timestamp: Date
    status: Status

    #connections
    user: User
    school: School
    roles: [Role]

    #query
    checkAllowed(permission_name: ID!): Boolean

    #mutations
    addRole(role_id: ID!): Role
    addRoles(role_ids: [ID!]!): [Role]
    removeRole(role_id: ID!): SchoolMembership
    leave(_: Int): Boolean
}

type Class {
    class_id: ID!

    #properties
    class_name: String
    status: Status
    shortcode: String
    #connections
    organization: Organization
    schools: [School]
    teachers: [User]
    students: [User]
    # schedule: [ScheduleEntry]

    # query
    programs: [Program!]
    age_ranges: [AgeRange!]
    grades: [Grade!]
    subjects: [Subject!]
    eligibleTeachers: [User]
    eligibleStudents: [User]

    #mutations
    set(class_name: String, shortcode: String): Class
    addTeacher(user_id: ID!): User
    editTeachers(teacher_ids: [ID!]): [User]
    removeTeacher(user_id: ID!): Boolean
    addStudent(user_id: ID!): User
    editStudents(student_ids: [ID!]): [User]
    removeStudent(user_id: ID!): Boolean
    editSchools(school_ids: [ID!]): [School]
    addSchool(school_id: ID!): School
    editPrograms(program_ids: [ID!]): [Program]
    editAgeRanges(age_range_ids: [ID!]): [AgeRange]
    editGrades(grade_ids: [ID!]): [Grade]
    editSubjects(subject_ids: [ID!]): [Subject]
    removeSchool(school_id: ID!): Boolean

    delete(_: Int): Boolean
    # addSchedule(id: ID!, timestamp: Date): Boolean
    # removeSchedule(id: ID!): Boolean
}

enum AgeRangeUnit {
    year
    month
}

enum Status {
    active
    inactive
}

input AgeRangeDetail {
    id: ID
    name: String
    low_value: Int
    high_value: Int
    low_value_unit: AgeRangeUnit
    high_value_unit: AgeRangeUnit
    system: Boolean
}

input CategoryDetail {
    id: ID
    name: String
    subcategories: [ID!]
    system: Boolean
}

input GradeDetail {
    id: ID
    name: String
    progress_from_grade_id: ID
    progress_to_grade_id: ID
    system: Boolean
}

input SubcategoryDetail {
    id: ID
    name: String
    system: Boolean
}

input SubjectDetail {
    id: ID
    name: String
    categories: [ID!]
    system: Boolean
}

input ProgramDetail {
    id: ID
    name: String
    system: Boolean
    age_ranges: [ID!]
    grades: [ID!]
    subjects: [ID!]
    status: Status
}

type AgeRange {
    id: ID!
    name: String!
    low_value: Int!
    high_value: Int!
    low_value_unit: AgeRangeUnit!
    high_value_unit: AgeRangeUnit!
    system: Boolean!
    status: Status

    # Mutations
    delete(_: Int): Boolean
}

type Category {
    id: ID!
    name: String!
    subcategories: [Subcategory!]
    system: Boolean!
    status: Status

    # Mutations
    editSubcategories(subcategory_ids: [ID!]): [Subcategory]
    delete(_: Int): Boolean
}

type Grade {
    id: ID!
    name: String!
    progress_from_grade: Grade
    progress_to_grade: Grade
    system: Boolean!
    status: Status

    # Mutations
    delete(_: Int): Boolean
}

type Subcategory {
    id: ID!
    name: String!
    system: Boolean!
    status: Status

    # Mutations
    delete(_: Int): Boolean
}

type Program {
    id: ID!
    name: String!
    system: Boolean!
    status: Status
    age_ranges: [AgeRange!]
    grades: [Grade!]
    subjects: [Subject!]

    # Mutations
    editAgeRanges(age_range_ids: [ID!]): [AgeRange]
    editGrades(grade_ids: [ID!]): [Grade]
    editSubjects(subject_ids: [ID!]): [Subject]

    delete(_: Int): Boolean
}

type Subject {
    id: ID!
    name: String!
    categories: [Category!]
    subcategories: [Subcategory!]
    system: Boolean!
    status: Status

    # Mutations
    delete(_: Int): Boolean
}

type ScheduleEntry {
    id: ID!
    timestamp: Date
}
